(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,11979,e=>{"use strict";var a=e.i(43476),t=e.i(71645);function i(e){return Math.max(0,Math.ceil((new Date(e).getTime()-Date.now())/1e3))}function o(e){return e&&"object"==typeof e?{status:"string"==typeof e.status?e.status:void 0,liberar_em:"string"==typeof e.liberar_em?e.liberar_em:null,faltam_ms:"number"==typeof e.faltam_ms?e.faltam_ms:void 0,erro:"string"==typeof e.erro?e.erro:void 0}:{}}function s({slug:e,tipo:s,assinanteAtivo:n=!1,className:r}){let[l,d]=(0,t.useState)(!0),[c,u]=(0,t.useState)(!1),[m,h]=(0,t.useState)("nao_iniciado"),[w,f]=(0,t.useState)(null),[p,x]=(0,t.useState)(0),b=(0,t.useRef)(null);function g(){null!==b.current&&(window.clearInterval(b.current),b.current=null)}function v(e){f(e),x(i(e)),g(),b.current=window.setInterval(()=>{let a=i(e);x(a),a<=0&&(h("liberado"),g())},250)}async function j(){try{let e=await fetch("/api/assinaturas/me",{method:"GET"});if(!e.ok)return;let a=await e.json();if(!a?.assinatura)return;let{periodo_fim:t,status:i,id:o}=a.assinatura;if(!t||"ativa"!==i)return;let s=new Date;new Date(t)<s&&await fetch("/api/assinaturas/inativar",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({assinaturaId:o})})}catch{}}async function N(){d(!0);try{if(await j(),n){g(),h("nao_iniciado"),f(null),x(0);return}if(!e||"undefined"===e){h("nao_iniciado"),f(null),x(0);return}let a=await fetch(`/api/download-gratis/status?slug=${encodeURIComponent(e)}&tipo=${encodeURIComponent(s)}`,{method:"GET"}),t=await a.json().catch(()=>null),i=o(t);if(!a.ok||!i.status||"nao_iniciado"===i.status||"sem_login"===i.status){h("nao_iniciado"),f(null),x(0);return}if("contando"===i.status&&i.liberar_em){h("aguardando"),v(i.liberar_em);return}if("liberado"===i.status&&i.liberar_em){h("liberado"),f(i.liberar_em),x(0);return}h("nao_iniciado"),f(null),x(0)}finally{d(!1)}}async function y(){let a=await fetch("/api/download-gratis/iniciar",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({slug:e,tipo:s})}),t=await a.json().catch(()=>null),i=o(t);if(!a.ok)throw Error(i.erro??"Não foi possível iniciar a contagem.");let n=function(e){if(!e||"object"!=typeof e||!("timer"in e))return null;let a=e.timer;return a&&"object"==typeof a&&"string"==typeof a.liberar_em?a.liberar_em:null}(t);if(!n)throw Error("Resposta inválida do servidor (liberar_em ausente).");h("aguardando"),v(n)}async function _(){let a=await fetch("/api/download-gratis/baixar",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({slug:e,tipo:s})}),t=await a.json().catch(()=>null),n=o(t);if(401===a.status){window.location.href=`/login?retorno=${encodeURIComponent(window.location.pathname)}`;return}if(a.ok){let e=t&&"object"==typeof t?t.url:null;if("string"!=typeof e||!e)throw Error("Resposta inválida do servidor (url ausente).");window.location.href=e;return}if(n.liberar_em)return void(i(n.liberar_em)>0?(h("aguardando"),v(n.liberar_em)):(h("liberado"),f(n.liberar_em),x(0)));throw Error(n.erro??"Não foi possível baixar agora.")}async function S(){if(!c){u(!0);try{await _()}catch(a){let e=a instanceof Error?a.message:"Erro inesperado.";if(e.toLowerCase().includes("inicie a contagem"))try{await y()}catch(e){alert(e instanceof Error?e.message:"Erro inesperado.")}else alert(e)}finally{u(!1)}}}(0,t.useEffect)(()=>(N(),()=>g()),[e,s,n]);let E="Baixar";if(l)E="Carregando...";else if(n)E="Baixar agora";else if("nao_iniciado"===m)E="Baixar";else if("aguardando"===m){let e;E=`Liberando em ${e=Math.floor(p/60),`${String(e).padStart(2,"0")}:${String(p%60).padStart(2,"0")}`}`}else"liberado"===m&&(E="Baixar agora");let k=(0,t.useMemo)(()=>c||!n&&"aguardando"===m,[c,m,n]);return(0,a.jsx)("button",{type:"button",onClick:()=>void S(),disabled:k,className:r??"w-full rounded-xl bg-white/10 px-4 py-3 text-sm text-white backdrop-blur transition hover:bg-white/15 disabled:cursor-not-allowed disabled:opacity-60",children:E})}e.s(["BotaoDownloadUnico",()=>s])},25897,e=>{"use strict";var a=e.i(43476),t=e.i(71645),i=e.i(18566),o=e.i(22016),s=e.i(68694),n=e.i(11979);function r(){let e;(0,t.useMemo)(()=>(0,s.criarSupabaseNavegador)(),[]);let r=(0,i.useParams)(),l=r?.slug??"",[d,c]=(0,t.useState)(null),[u,m]=(0,t.useState)([]),[h,w]=(0,t.useState)(!0),[f,p]=(0,t.useState)(null),[x,b]=(0,t.useState)("descricao");return((0,t.useEffect)(()=>{l&&(async()=>{w(!0),p(null);let e=await fetch(`/api/daws?slug=${encodeURIComponent(l)}`,{cache:"no-store"});if(!e.ok){c(null),p("Daw não encontrado."),w(!1);return}c((await e.json()).daw),w(!1)})()},[l]),(0,t.useEffect)(()=>{d&&(async()=>{let e=await fetch(`/api/daws?limit=6&exclude=${d.slug}`,{cache:"no-store"});e.ok&&m((await e.json()).daws??[])})()},[d]),h)?(0,a.jsx)("div",{className:"text-white/70",children:"Carregando daw…"}):d?(0,a.jsxs)("div",{className:"flex flex-col gap-6",children:[(0,a.jsxs)("section",{className:"relative rounded-3xl border border-white/10 bg-white/5 overflow-hidden",children:[(0,a.jsx)("div",{className:"w-full bg-black/40",children:d.imagem_capa_url?(0,a.jsx)("img",{src:d.imagem_capa_url,alt:d.nome,style:{width:"100%",height:"auto",display:"block"}}):(0,a.jsx)("div",{className:"aspect-[2/1] bg-gradient-to-br from-white/10 to-black/40"})}),(0,a.jsx)("div",{className:"pointer-events-none absolute inset-0 bg-gradient-to-t from-black/80 via-black/40 to-transparent"}),(0,a.jsxs)("div",{className:"absolute bottom-0 left-0 right-0 p-6 md:p-10",children:[(0,a.jsx)("h1",{className:"text-3xl md:text-5xl font-semibold",children:d.nome}),d.subtitulo&&(0,a.jsx)("p",{className:"mt-3 max-w-3xl text-white/80",children:d.subtitulo})]})]}),(0,a.jsx)("section",{className:"rounded-3xl border border-white/10 bg-white/5 p-6 md:p-8",children:(0,a.jsxs)("div",{className:"flex flex-col gap-4 md:flex-row md:items-center md:justify-between",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"text-sm text-white/60",children:"Download"}),(0,a.jsx)("div",{className:"text-lg",children:"Baixe com 1 clique"}),(0,a.jsx)("div",{className:"text-sm text-white/60",children:"Assinante: imediato • Não assinante: libera em 15 min"})]}),(0,a.jsx)("div",{className:"w-full md:w-[360px]",children:(0,a.jsx)(n.BotaoDownloadUnico,{slug:d.slug,tipo:"daw"})})]})}),(0,a.jsxs)("section",{className:"rounded-3xl border border-white/10 bg-white/5 p-6 md:p-8",children:[(0,a.jsx)("div",{className:"mb-6 flex gap-2 border-b border-white/10",children:[["descricao","Descrição"],["instalacao","Instalação"],["relacionados","Você pode gostar também"]].map(([e,t])=>(0,a.jsx)("button",{onClick:()=>b(e),className:`px-4 pb-3 text-sm font-medium transition ${x===e?"border-b-2 border-white text-white":"text-white/60 hover:text-white"}`,children:t},e))}),"descricao"===x&&(0,a.jsx)("div",{className:"text-white/80 whitespace-pre-line",children:d.descricao||(0,a.jsx)("p",{className:"text-white/50",children:"Este daw ainda não possui descrição."})}),"instalacao"===x&&(0,a.jsx)("div",{children:"video"===d.tipo_instalacao?d.conteudo_instalacao?(0,a.jsx)("div",{className:"relative aspect-video overflow-hidden rounded-2xl border border-white/10",children:(e=function(e){try{let a=new URL(e);if(a.hostname.includes("youtu.be"))return`https://www.youtube.com/embed/${a.pathname.slice(1)}`;if(a.hostname.includes("youtube.com")){let e=a.searchParams.get("v");if(e)return`https://www.youtube.com/embed/${e}`}return null}catch{return null}}(d.conteudo_instalacao))?(0,a.jsx)("iframe",{src:e,title:`Instala\xe7\xe3o - ${d.nome}`,className:"absolute inset-0 h-full w-full",allowFullScreen:!0}):(0,a.jsx)("p",{className:"text-white/50",children:"Vídeo de instalação inválido."})}):(0,a.jsx)("p",{className:"text-white/50",children:"Este daw ainda não possui vídeo de instalação."}):d.conteudo_instalacao?(0,a.jsx)("div",{className:"whitespace-pre-line text-white/80",children:d.conteudo_instalacao}):(0,a.jsx)("p",{className:"text-white/50",children:"Nenhuma instrução de instalação disponível."})}),"relacionados"===x&&(0,a.jsx)("div",{children:0===u.length?(0,a.jsx)("p",{className:"text-white/50",children:"Nenhuma sugestão disponível no momento."}):(0,a.jsx)("div",{className:"grid gap-4 sm:grid-cols-2 lg:grid-cols-3",children:u.map(e=>(0,a.jsxs)(o.default,{href:`/daws/${e.slug}`,className:"group overflow-hidden rounded-2xl border border-white/10 bg-white/5 transition hover:bg-white/10",children:[(0,a.jsx)("div",{className:"aspect-[16/9] w-full overflow-hidden",children:e.imagem_capa_url?(0,a.jsx)("img",{src:e.imagem_capa_url,alt:e.nome,className:"h-full w-full object-cover transition group-hover:scale-105"}):(0,a.jsx)("div",{className:"h-full w-full bg-white/10"})}),(0,a.jsxs)("div",{className:"p-4",children:[(0,a.jsx)("div",{className:"font-medium",children:e.nome}),e.subtitulo&&(0,a.jsx)("div",{className:"mt-1 text-sm text-white/60 line-clamp-2",children:e.subtitulo})]})]},e.id))})})]})]}):(0,a.jsx)("div",{className:"text-white/70",children:f??"Daw não encontrado."})}e.s(["default",()=>r])}]);