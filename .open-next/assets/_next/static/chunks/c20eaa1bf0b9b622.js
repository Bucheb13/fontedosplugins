(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,72864,e=>{"use strict";var t=e.i(43476),a=e.i(71645),l=e.i(18566),s=e.i(32818);async function i(e){let t=await e.text();try{return t?JSON.parse(t):{}}catch{return{erro:t||"Resposta inválida do servidor"}}}function r(){let{senhaAdmin:e,setMensagem:r}=(0,s.useAdmin)(),d=(0,l.useParams)().slug,[o,n]=(0,a.useState)(!1),[c,u]=(0,a.useState)(!1),[x,m]=(0,a.useState)(null),[h,b]=(0,a.useState)(!1),[p,v]=(0,a.useState)(!1),[g,w]=(0,a.useState)(!1),[f,j]=(0,a.useState)(""),[N,y]=(0,a.useState)(""),[k,S]=(0,a.useState)(!0),[T,C]=(0,a.useState)(""),[_,R]=(0,a.useState)("video"),[q,D]=(0,a.useState)(""),[A,F]=(0,a.useState)(null),[O,P]=(0,a.useState)(null),E=(0,a.useRef)(null),U=(0,a.useRef)(null),$=(0,a.useCallback)(async()=>{if(r(null),!e)return void n(!1);u(!0);try{let t=await fetch("/api/admin/validar",{headers:{"x-senha-admin":e},cache:"no-store"});if(u(!1),!t.ok){n(!1),r("Senha admin inválida.");return}n(!0)}catch{u(!1),n(!1),r("Falha ao validar a senha.")}},[e,r]),I=(0,a.useCallback)(async()=>{if(r(null),!o)return void r("Digite a senha correta do admin.");b(!0);let t=await fetch(`/api/admin/daws/obter?slug=${encodeURIComponent(d)}`,{headers:{"x-senha-admin":e},cache:"no-store"}),a=await i(t);if(b(!1),!t.ok)return void r(a?.erro??"Falha ao carregar daw.");let l=a.daw??null;m(l),l&&(j(l.nome??""),y(l.subtitulo??""),C(l.descricao??""),R(l.tipo_instalacao??"video"),D(l.conteudo_instalacao??""),S(l.ativo??!0))},[o,e,r,d]);(0,a.useEffect)(()=>{let e=setTimeout(()=>void $(),0);return()=>clearTimeout(e)},[$]),(0,a.useEffect)(()=>{if(!o)return;let e=setTimeout(()=>void I(),0);return()=>clearTimeout(e)},[o,I]);let Y=(0,a.useCallback)(async()=>{if(r(null),!o)return r("Digite a senha correta do admin.");let t=f.trim();if(!t)return r("Nome é obrigatório.");if("video"===_){let e=q.trim();if(!e)return r("Informe o link do vídeo do YouTube.");if(!function(e){try{let t=new URL(e);return t.hostname.includes("youtube.com")||t.hostname.includes("youtu.be")}catch{return!1}}(e))return r("Informe uma URL válida do YouTube.")}if("texto"===_&&!q.trim())return r("O texto de instalação é obrigatório.");v(!0);let a=await fetch("/api/admin/daws/editar",{method:"POST",headers:{"Content-Type":"application/json","x-senha-admin":e},body:JSON.stringify({slug:d,nome:t,subtitulo:N.trim()||null,descricao:T.trim()||null,tipo_instalacao:_,conteudo_instalacao:q.trim()||null,ativo:k})}).catch(()=>null);if(!a)return v(!1),r("Falha de rede ao salvar.");let l=await i(a);if(v(!1),!a.ok)return r(l?.erro??`Falha ao salvar (HTTP ${a.status}).`);let s=l.daw??null;s&&(m(s),j(s.nome??""),y(s.subtitulo??""),C(s.descricao??""),R(s.tipo_instalacao??"video"),D(s.conteudo_instalacao??"")),r("Salvo com sucesso.")},[o,e,r,d,f,N,T,_,q,k]),L=(0,a.useCallback)(async()=>{if(r(null),!o)return r("Digite a senha correta do admin.");if(!A&&!O)return r("Selecione uma capa e/ou um .torrent.");w(!0);let t=new FormData;t.append("slug",d),A&&t.append("capa",A),O&&t.append("torrent",O);let a=await fetch("/api/admin/daws/editar-arquivos",{method:"POST",headers:{"x-senha-admin":e},body:t}).catch(()=>null);if(!a)return w(!1),r("Falha de rede ao enviar arquivos.");let l=await i(a);if(w(!1),!a.ok)return r(l?.erro??`Falha ao enviar (HTTP ${a.status}).`);let s=l.daw??null;s&&(m(s),j(s.nome??""),y(s.subtitulo??"")),F(null),P(null),r("Arquivos atualizados com sucesso.")},[o,e,r,d,A,O]);return e?c?(0,t.jsx)("div",{className:"rounded-3xl border border-white/10 bg-white/5 p-6 md:p-8 text-sm text-white/70",children:"Validando senha…"}):o?h||!x?(0,t.jsx)("div",{className:"rounded-3xl border border-white/10 bg-white/5 p-6 md:p-8 text-sm text-white/70",children:h?"Carregando…":"Daw não encontrado."}):(0,t.jsxs)("div",{className:"flex flex-col gap-6",children:[(0,t.jsxs)("section",{className:"rounded-3xl border border-white/10 bg-white/5 p-6 md:p-8",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between gap-3",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("h2",{className:"text-xl font-semibold",children:"Editar daw"}),(0,t.jsxs)("p",{className:"mt-1 text-sm text-white/70",children:["slug: ",(0,t.jsx)("span",{className:"text-white/80",children:x.slug})]})]}),(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)("button",{type:"button",onClick:()=>void I(),disabled:p||h||g,className:"rounded-xl border border-white/10 bg-black/30 px-4 py-2 text-xs hover:bg-black/40 disabled:opacity-60",children:"Recarregar"}),(0,t.jsx)("button",{type:"button",onClick:()=>void Y(),disabled:p||g,className:"rounded-xl bg-white px-4 py-2 text-xs font-semibold text-black disabled:opacity-60",children:p?"Salvando…":"Salvar"})]})]}),(0,t.jsxs)("div",{className:"mt-6 grid gap-4 md:grid-cols-2",children:[(0,t.jsxs)("div",{className:"flex flex-col gap-2 md:col-span-2",children:[(0,t.jsx)("label",{className:"text-xs text-white/60",children:"Nome"}),(0,t.jsx)("input",{value:f,onChange:e=>j(e.target.value),className:"rounded-2xl border border-white/10 bg-black/30 px-4 py-3 text-sm outline-none"})]}),(0,t.jsxs)("div",{className:"flex flex-col gap-2 md:col-span-2",children:[(0,t.jsx)("label",{className:"text-xs text-white/60",children:"Subtitulo"}),(0,t.jsx)("textarea",{value:N,onChange:e=>y(e.target.value),rows:5,className:"rounded-2xl border border-white/10 bg-black/30 px-4 py-3 text-sm outline-none"})]}),(0,t.jsxs)("div",{className:"flex flex-col gap-2 md:col-span-2",children:[(0,t.jsx)("label",{className:"text-xs text-white/60",children:"Descrição completa"}),(0,t.jsx)("textarea",{value:T,onChange:e=>C(e.target.value),rows:6,className:"rounded-2xl border border-white/10 bg-black/30 px-4 py-3 text-sm outline-none",placeholder:"Descrição detalhada do daw…"})]}),(0,t.jsxs)("div",{className:"flex flex-col gap-2 md:col-span-2",children:[(0,t.jsx)("label",{className:"text-xs text-white/60",children:"Tipo de conteúdo de instalação"}),(0,t.jsxs)("select",{value:_,onChange:e=>{R(e.target.value),D("")},className:"rounded-2xl border border-white/10 bg-black/30 px-4 py-3 text-sm outline-none",children:[(0,t.jsx)("option",{value:"video",children:"Vídeo (YouTube)"}),(0,t.jsx)("option",{value:"texto",children:"Texto / Instruções"})]})]}),"video"===_&&(0,t.jsxs)("div",{className:"flex flex-col gap-2 md:col-span-2",children:[(0,t.jsx)("label",{className:"text-xs text-white/60",children:"Link do vídeo (YouTube)"}),(0,t.jsx)("input",{value:q,onChange:e=>D(e.target.value),placeholder:"https://www.youtube.com/watch?v=...",className:"rounded-2xl border border-white/10 bg-black/30 px-4 py-3 text-sm outline-none"})]}),"texto"===_&&(0,t.jsxs)("div",{className:"flex flex-col gap-2 md:col-span-2",children:[(0,t.jsx)("label",{className:"text-xs text-white/60",children:"Texto de instalação"}),(0,t.jsx)("textarea",{value:q,onChange:e=>D(e.target.value),rows:6,placeholder:"Explique como instalar o daw...",className:"rounded-2xl border border-white/10 bg-black/30 px-4 py-3 text-sm outline-none"})]}),(0,t.jsxs)("label",{className:"flex items-center gap-2 rounded-2xl border border-white/10 bg-black/30 px-4 py-3 text-sm md:col-span-2",children:[(0,t.jsx)("input",{type:"checkbox",checked:k,onChange:e=>S(e.target.checked)}),(0,t.jsx)("span",{className:"text-white/80",children:"Ativo"})]})]})]}),(0,t.jsxs)("section",{className:"rounded-3xl border border-white/10 bg-white/5 p-6 md:p-8",children:[(0,t.jsx)("h3",{className:"text-lg font-semibold",children:"Arquivos (R2)"}),(0,t.jsx)("p",{className:"mt-1 text-sm text-white/60",children:"Atualize a capa e/ou o .torrent deste daw."}),(0,t.jsxs)("div",{className:"mt-4 grid gap-3",children:[(0,t.jsxs)("div",{className:"rounded-2xl border border-white/10 bg-black/20 p-4",children:[(0,t.jsx)("div",{className:"text-white/70 text-xs",children:"Capa atual"}),x.imagem_capa_url?(0,t.jsxs)("div",{className:"mt-3 flex items-center gap-4",children:[(0,t.jsx)("img",{src:x.imagem_capa_url,alt:x.nome,className:"h-20 w-20 rounded-xl object-cover border border-white/10"}),(0,t.jsx)("div",{className:"text-xs text-white/60 break-all",children:x.imagem_capa_url})]}):(0,t.jsx)("div",{className:"mt-2 text-white/70",children:"Sem capa"})]}),(0,t.jsxs)("div",{className:"rounded-2xl border border-white/10 bg-black/20 p-4",children:[(0,t.jsx)("div",{className:"text-white/70 text-xs",children:"Torrent atual"}),(0,t.jsx)("div",{className:"mt-2 text-white/70",children:x.r2_chave_arquivo?x.r2_chave_arquivo:"Sem torrent"})]})]}),(0,t.jsxs)("div",{className:"mt-4 grid gap-4 md:grid-cols-2",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("div",{className:"text-xs text-white/60 mb-2",children:"Nova capa"}),(0,t.jsx)("input",{ref:E,type:"file",accept:"image/png,image/jpeg,image/webp,image/gif",className:"hidden",onChange:e=>{F(e.target.files?.[0]??null),e.currentTarget.value=""}}),(0,t.jsx)("button",{type:"button",onClick:()=>E.current?.click(),disabled:g,className:"w-full rounded-2xl border border-white/10 bg-black/30 px-4 py-3 text-sm text-left disabled:opacity-60",children:A?`✅ ${A.name}`:"Selecionar imagem…"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("div",{className:"text-xs text-white/60 mb-2",children:"Novo .torrent"}),(0,t.jsx)("input",{ref:U,type:"file",accept:".torrent,application/x-bittorrent",className:"hidden",onChange:e=>{P(e.target.files?.[0]??null),e.currentTarget.value=""}}),(0,t.jsx)("button",{type:"button",onClick:()=>U.current?.click(),disabled:g,className:"w-full rounded-2xl border border-white/10 bg-black/30 px-4 py-3 text-sm text-left disabled:opacity-60",children:O?`✅ ${O.name}`:"Selecionar .torrent…"})]})]}),(0,t.jsx)("div",{className:"mt-4 flex items-center justify-end",children:(0,t.jsx)("button",{type:"button",onClick:()=>void L(),disabled:g||!A&&!O,className:"rounded-2xl bg-white px-6 py-3 text-sm font-semibold text-black disabled:opacity-60",children:g?"Enviando…":"Enviar arquivos"})})]})]}):(0,t.jsx)("div",{className:"rounded-3xl border border-white/10 bg-white/5 p-6 md:p-8 text-sm text-white/70",children:"Senha admin inválida."}):(0,t.jsx)("div",{className:"rounded-3xl border border-white/10 bg-white/5 p-6 md:p-8 text-sm text-white/70",children:"Digite a senha do admin no header para editar este daw."})}e.s(["default",()=>r])}]);