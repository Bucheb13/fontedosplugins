(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,11979,e=>{"use strict";var t=e.i(43476),a=e.i(71645);function i(e){return Math.max(0,Math.ceil((new Date(e).getTime()-Date.now())/1e3))}function o(e){return e&&"object"==typeof e?{status:"string"==typeof e.status?e.status:void 0,liberar_em:"string"==typeof e.liberar_em?e.liberar_em:null,faltam_ms:"number"==typeof e.faltam_ms?e.faltam_ms:void 0,erro:"string"==typeof e.erro?e.erro:void 0}:{}}function r({slug:e,tipo:r,assinanteAtivo:s=!1,className:n}){let[l,d]=(0,a.useState)(!0),[c,u]=(0,a.useState)(!1),[m,h]=(0,a.useState)("nao_iniciado"),[f,w]=(0,a.useState)(null),[p,x]=(0,a.useState)(0),b=(0,a.useRef)(null);function g(){null!==b.current&&(window.clearInterval(b.current),b.current=null)}function v(e){w(e),x(i(e)),g(),b.current=window.setInterval(()=>{let t=i(e);x(t),t<=0&&(h("liberado"),g())},250)}async function j(){try{let e=await fetch("/api/assinaturas/me",{method:"GET"});if(!e.ok)return;let t=await e.json();if(!t?.assinatura)return;let{periodo_fim:a,status:i,id:o}=t.assinatura;if(!a||"ativa"!==i)return;let r=new Date;new Date(a)<r&&await fetch("/api/assinaturas/inativar",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({assinaturaId:o})})}catch{}}async function N(){d(!0);try{if(await j(),s){g(),h("nao_iniciado"),w(null),x(0);return}if(!e||"undefined"===e){h("nao_iniciado"),w(null),x(0);return}let t=await fetch(`/api/download-gratis/status?slug=${encodeURIComponent(e)}&tipo=${encodeURIComponent(r)}`,{method:"GET"}),a=await t.json().catch(()=>null),i=o(a);if(!t.ok||!i.status||"nao_iniciado"===i.status||"sem_login"===i.status){h("nao_iniciado"),w(null),x(0);return}if("contando"===i.status&&i.liberar_em){h("aguardando"),v(i.liberar_em);return}if("liberado"===i.status&&i.liberar_em){h("liberado"),w(i.liberar_em),x(0);return}h("nao_iniciado"),w(null),x(0)}finally{d(!1)}}async function y(){let t=await fetch("/api/download-gratis/iniciar",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({slug:e,tipo:r})}),a=await t.json().catch(()=>null),i=o(a);if(!t.ok)throw Error(i.erro??"Não foi possível iniciar a contagem.");let s=function(e){if(!e||"object"!=typeof e||!("timer"in e))return null;let t=e.timer;return t&&"object"==typeof t&&"string"==typeof t.liberar_em?t.liberar_em:null}(a);if(!s)throw Error("Resposta inválida do servidor (liberar_em ausente).");h("aguardando"),v(s)}async function _(){let t=await fetch("/api/download-gratis/baixar",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({slug:e,tipo:r})}),a=await t.json().catch(()=>null),s=o(a);if(401===t.status){window.location.href=`/login?retorno=${encodeURIComponent(window.location.pathname)}`;return}if(t.ok){let e=a&&"object"==typeof a?a.url:null;if("string"!=typeof e||!e)throw Error("Resposta inválida do servidor (url ausente).");window.location.href=e;return}if(s.liberar_em)return void(i(s.liberar_em)>0?(h("aguardando"),v(s.liberar_em)):(h("liberado"),w(s.liberar_em),x(0)));throw Error(s.erro??"Não foi possível baixar agora.")}async function S(){if(!c){u(!0);try{await _()}catch(t){let e=t instanceof Error?t.message:"Erro inesperado.";if(e.toLowerCase().includes("inicie a contagem"))try{await y()}catch(e){alert(e instanceof Error?e.message:"Erro inesperado.")}else alert(e)}finally{u(!1)}}}(0,a.useEffect)(()=>(N(),()=>g()),[e,r,s]);let k="Baixar";if(l)k="Carregando...";else if(s)k="Baixar agora";else if("nao_iniciado"===m)k="Baixar";else if("aguardando"===m){let e;k=`Liberando em ${e=Math.floor(p/60),`${String(e).padStart(2,"0")}:${String(p%60).padStart(2,"0")}`}`}else"liberado"===m&&(k="Baixar agora");let E=(0,a.useMemo)(()=>c||!s&&"aguardando"===m,[c,m,s]);return(0,t.jsx)("button",{type:"button",onClick:()=>void S(),disabled:E,className:n??"w-full rounded-xl bg-white/10 px-4 py-3 text-sm text-white backdrop-blur transition hover:bg-white/15 disabled:cursor-not-allowed disabled:opacity-60",children:k})}e.s(["BotaoDownloadUnico",()=>r])},26517,e=>{"use strict";var t=e.i(43476),a=e.i(71645),i=e.i(18566),o=e.i(22016),r=e.i(68694),s=e.i(11979);function n(){let e;(0,a.useMemo)(()=>(0,r.criarSupabaseNavegador)(),[]);let n=(0,i.useParams)(),l=n?.slug??"",[d,c]=(0,a.useState)(null),[u,m]=(0,a.useState)([]),[h,f]=(0,a.useState)(!0),[w,p]=(0,a.useState)(null),[x,b]=(0,a.useState)("descricao");return((0,a.useEffect)(()=>{l&&(async()=>{f(!0),p(null);let e=await fetch(`/api/drum-kit?slug=${encodeURIComponent(l)}`,{cache:"no-store"});if(!e.ok){c(null),p("DrumKit não encontrado."),f(!1);return}c((await e.json()).drumKit),f(!1)})()},[l]),(0,a.useEffect)(()=>{d&&(async()=>{let e=await fetch(`/api/drum-kit?limit=6&exclude=${d.slug}`,{cache:"no-store"});e.ok&&m((await e.json()).drumKits??[])})()},[d]),h)?(0,t.jsx)("div",{className:"text-white/70",children:"Carregando drumKit…"}):d?(0,t.jsxs)("div",{className:"flex flex-col gap-6",children:[(0,t.jsxs)("section",{className:"relative rounded-3xl border border-white/10 bg-white/5 overflow-hidden",children:[(0,t.jsx)("div",{className:"w-full bg-black/40",children:d.imagem_capa_url?(0,t.jsx)("img",{src:d.imagem_capa_url,alt:d.nome,style:{width:"100%",height:"auto",display:"block"}}):(0,t.jsx)("div",{className:"aspect-[2/1] bg-gradient-to-br from-white/10 to-black/40"})}),(0,t.jsx)("div",{className:"pointer-events-none absolute inset-0 bg-gradient-to-t from-black/80 via-black/40 to-transparent"}),(0,t.jsxs)("div",{className:"absolute bottom-0 left-0 right-0 p-6 md:p-10",children:[(0,t.jsx)("h1",{className:"text-3xl md:text-5xl font-semibold",children:d.nome}),d.subtitulo&&(0,t.jsx)("p",{className:"mt-3 max-w-3xl text-white/80",children:d.subtitulo})]})]}),(0,t.jsx)("section",{className:"rounded-3xl border border-white/10 bg-white/5 p-6 md:p-8",children:(0,t.jsxs)("div",{className:"flex flex-col gap-4 md:flex-row md:items-center md:justify-between",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("div",{className:"text-sm text-white/60",children:"Download"}),(0,t.jsx)("div",{className:"text-lg",children:"Baixe com 1 clique"}),(0,t.jsx)("div",{className:"text-sm text-white/60",children:"Assinante: imediato • Não assinante: libera em 15 min"})]}),(0,t.jsx)("div",{className:"w-full md:w-[360px]",children:(0,t.jsx)(s.BotaoDownloadUnico,{slug:d.slug,tipo:"drum-kit"})})]})}),(0,t.jsxs)("section",{className:"rounded-3xl border border-white/10 bg-white/5 p-6 md:p-8",children:[(0,t.jsx)("div",{className:"mb-6 flex gap-2 border-b border-white/10",children:[["descricao","Descrição"],["instalacao","Instalação"],["relacionados","Você pode gostar também"]].map(([e,a])=>(0,t.jsx)("button",{onClick:()=>b(e),className:`px-4 pb-3 text-sm font-medium transition ${x===e?"border-b-2 border-white text-white":"text-white/60 hover:text-white"}`,children:a},e))}),"descricao"===x&&(0,t.jsx)("div",{className:"text-white/80 whitespace-pre-line",children:d.descricao||(0,t.jsx)("p",{className:"text-white/50",children:"Este drumKit ainda não possui descrição."})}),"instalacao"===x&&(0,t.jsx)("div",{children:"video"===d.tipo_instalacao?d.conteudo_instalacao?(0,t.jsx)("div",{className:"relative aspect-video overflow-hidden rounded-2xl border border-white/10",children:(e=function(e){try{let t=new URL(e);if(t.hostname.includes("youtu.be"))return`https://www.youtube.com/embed/${t.pathname.slice(1)}`;if(t.hostname.includes("youtube.com")){let e=t.searchParams.get("v");if(e)return`https://www.youtube.com/embed/${e}`}return null}catch{return null}}(d.conteudo_instalacao))?(0,t.jsx)("iframe",{src:e,title:`Instala\xe7\xe3o - ${d.nome}`,className:"absolute inset-0 h-full w-full",allowFullScreen:!0}):(0,t.jsx)("p",{className:"text-white/50",children:"Vídeo de instalação inválido."})}):(0,t.jsx)("p",{className:"text-white/50",children:"Este drumKit ainda não possui vídeo de instalação."}):d.conteudo_instalacao?(0,t.jsx)("div",{className:"whitespace-pre-line text-white/80",children:d.conteudo_instalacao}):(0,t.jsx)("p",{className:"text-white/50",children:"Nenhuma instrução de instalação disponível."})}),"relacionados"===x&&(0,t.jsx)("div",{children:0===u.length?(0,t.jsx)("p",{className:"text-white/50",children:"Nenhuma sugestão disponível no momento."}):(0,t.jsx)("div",{className:"grid gap-4 sm:grid-cols-2 lg:grid-cols-3",children:u.map(e=>(0,t.jsxs)(o.default,{href:`/drum-kit/${e.slug}`,className:"group overflow-hidden rounded-2xl border border-white/10 bg-white/5 transition hover:bg-white/10",children:[(0,t.jsx)("div",{className:"aspect-[16/9] w-full overflow-hidden",children:e.imagem_capa_url?(0,t.jsx)("img",{src:e.imagem_capa_url,alt:e.nome,className:"h-full w-full object-cover transition group-hover:scale-105"}):(0,t.jsx)("div",{className:"h-full w-full bg-white/10"})}),(0,t.jsxs)("div",{className:"p-4",children:[(0,t.jsx)("div",{className:"font-medium",children:e.nome}),e.subtitulo&&(0,t.jsx)("div",{className:"mt-1 text-sm text-white/60 line-clamp-2",children:e.subtitulo})]})]},e.id))})})]})]}):(0,t.jsx)("div",{className:"text-white/70",children:w??"DrumKit não encontrado."})}e.s(["default",()=>n])}]);