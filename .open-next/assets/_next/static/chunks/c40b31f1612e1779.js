(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,82705,e=>{"use strict";var t=e.i(43476),a=e.i(71645);function s({message:e,type:s,onClose:r,duration:l=1e4}){return(0,a.useEffect)(()=>{let e=setTimeout(r,l);return()=>clearTimeout(e)},[r,l]),(0,t.jsx)("div",{className:"fixed top-16 left-1/2 z-50 -translate-x-1/2 animate-[slideIn_0.35s_ease-out]",children:(0,t.jsx)("div",{className:`rounded-xl border bg-black/80 px-4 py-3 text-sm backdrop-blur ${{success:"border-green-400/40 text-green-300 shadow-[0_0_25px_rgba(34,197,94,0.45)]",error:"border-red-500/40 text-red-300 shadow-[0_0_25px_rgba(239,68,68,0.45)]",info:"border-cyan-400/40 text-cyan-300 shadow-[0_0_25px_rgba(34,211,238,0.45)]"}[s]}`,children:e})})}e.s(["CyberToast",()=>s])},25547,e=>{"use strict";var t=e.i(43476),a=e.i(71645),s=e.i(18566),r=e.i(68694),l=e.i(82705);let i=[{id:"mensal",nome:"Mensal",preco:"R$ 7,00",valor:7,descricao:"Acesso completo por 1 mês."},{id:"anual",nome:"Anual",preco:"R$ 22,00",valor:22,descricao:"Acesso completo por 12 meses.",destaque:!0}];function o(e){return"object"==typeof e&&null!==e&&("ativa"===e.status||"inativa"===e.status)&&("mensal"===e.tipo||"anual"===e.tipo)&&"string"==typeof e.periodo_fim}function n(){let e=(0,s.useRouter)(),n=(0,r.criarSupabaseNavegador)(),[d,c]=(0,a.useState)(null),[u,m]=(0,a.useState)(null),[x,p]=(0,a.useState)({}),[h,b]=(0,a.useState)(""),[g,f]=(0,a.useState)(null),[w,v]=(0,a.useState)(null),[j,_]=(0,a.useState)([]),[y,N]=(0,a.useState)(null),P=(e,t="success")=>{let a=crypto.randomUUID();_(s=>[...s,{id:a,message:e,type:t}])};(0,a.useEffect)(()=>{n.auth.getUser().then(({data:e})=>c(e.user??null))},[n]),(0,a.useEffect)(()=>{d&&n.from("assinaturas").select("status, tipo, periodo_fim").eq("usuario_id",d.id).order("criado_em",{ascending:!1}).limit(1).maybeSingle().then(({data:e})=>{e&&o(e)?m(e):m(null)})},[d,n]),(0,a.useEffect)(()=>{if(!d)return;let e=n.channel(`assinaturas-${d.id}`).on("postgres_changes",{event:"*",schema:"public",table:"assinaturas",filter:`usuario_id=eq.${d.id}`},e=>{e.new&&o(e.new)&&"ativa"===e.new.status&&(m(e.new),P("Assinatura ativada!","success"),f(null),v(null))}).subscribe();return()=>{n.removeChannel(e)}},[d,n]);let C=async t=>{if(!d)return e.push("/login");let a=h.replace(/\D/g,"");if(11!==a.length)return void P("CPF inválido","error");N(t.id),p(e=>({...e,[t.id]:!0})),f(null),v(null);try{let e=await fetch("/api/pagamentos/ggpix/criar",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({usuario_id:d.id,nome:d.user_metadata?.nome??"Cliente",email:d.email,cpf:a,valor:t.valor})}),s=await e.json();if(!e.ok||!s.qr_code_url)throw Error("Erro PIX");f(s.qr_code_url),v(s.copia_cola),P("PIX gerado com sucesso!","success")}catch{P("Erro ao gerar PIX","error")}finally{p(e=>({...e,[t.id]:!1})),N(null)}},S=(0,a.useMemo)(()=>!!u&&"ativa"===u.status&&new Date(u.periodo_fim)>=new Date,[u]);return(0,t.jsxs)("section",{className:"mx-auto max-w-6xl px-4 py-16",children:[j.map(e=>(0,t.jsx)(l.CyberToast,{message:e.message,type:e.type,onClose:()=>{let t;return t=e.id,_(e=>e.filter(e=>e.id!==t))},duration:4e3},e.id)),(0,t.jsxs)("header",{className:"text-center mb-12",children:[(0,t.jsx)("h1",{className:"text-5xl font-bold text-cyan-400",children:"Assinaturas"}),(0,t.jsx)("p",{className:"mt-2 text-purple-300",children:"FonteDosPlugins"})]}),S&&u?(0,t.jsxs)("div",{className:"max-w-xl mx-auto rounded-3xl p-8 bg-black/30 border border-green-400 text-center",children:[(0,t.jsx)("h2",{className:"text-2xl font-bold text-green-400 mb-2",children:"Assinatura ativa"}),(0,t.jsxs)("p",{className:"text-white",children:["Plano: ",(0,t.jsx)("strong",{className:"capitalize",children:u.tipo})]}),(0,t.jsxs)("p",{className:"text-white mt-1",children:["Válida até: ",(0,t.jsx)("strong",{children:new Date(u.periodo_fim).toLocaleDateString("pt-BR")})]})]}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("div",{className:"max-w-md mx-auto mb-10",children:(0,t.jsx)("input",{type:"text",placeholder:"Digite seu CPF",value:h,onChange:e=>b(e.target.value),className:"w-full rounded-xl bg-black/20 border p-3 text-white"})}),(0,t.jsx)("div",{className:"grid md:grid-cols-2 gap-8",children:i.map(e=>(0,t.jsxs)("div",{className:`rounded-3xl p-8 border ${y===e.id?"border-cyan-400 bg-black/30 shadow-[0_0_20px_cyan]":"bg-black/20"}`,children:[(0,t.jsx)("h2",{className:"text-2xl text-cyan-400",children:e.nome}),(0,t.jsx)("p",{className:"text-3xl text-white mt-3",children:e.preco}),(0,t.jsx)("p",{className:"text-white/70 mt-2",children:e.descricao}),(0,t.jsx)("button",{onClick:()=>C(e),disabled:x[e.id],className:"mt-6 w-full border py-3 rounded-xl text-cyan-400 hover:bg-white/10 transition",children:x[e.id]?"Gerando PIX...":"Pagar com PIX"})]},e.id))})]}),g&&w&&(0,t.jsx)("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/80 backdrop-blur-sm",children:(0,t.jsxs)("div",{className:"bg-zinc-900 rounded-3xl p-6 w-full max-w-md text-center border border-cyan-400 shadow-lg",children:[(0,t.jsx)("h3",{className:"text-xl font-semibold text-cyan-400 mb-4",children:"Pague com PIX"}),(0,t.jsx)("img",{src:g,alt:"QR Code PIX",className:"mx-auto mb-4 rounded-lg bg-white p-2"}),(0,t.jsx)("textarea",{readOnly:!0,value:w,className:"w-full bg-black/20 text-white p-3 rounded-lg text-sm mb-4",rows:4}),(0,t.jsx)("button",{onClick:()=>{navigator.clipboard.writeText(w),P("Código PIX copiado!","success")},className:"w-full mb-3 border border-green-500 text-green-400 rounded-lg py-2 font-semibold hover:text-white hover:shadow-[0_0_15px_green] transition",children:"Copiar código PIX"}),(0,t.jsx)("button",{onClick:()=>{f(null),v(null)},className:"w-full text-red-400 border border-red-400 py-2 rounded-lg hover:text-white hover:shadow-[0_0_15px_red] transition font-semibold",children:"Fechar"}),(0,t.jsx)("p",{className:"mt-4 text-white/60 text-sm",children:"Após o pagamento, sua assinatura será ativada automaticamente."})]})})]})}e.s(["default",()=>n])}]);