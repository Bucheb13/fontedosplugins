(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,92560,e=>{"use strict";var a=e.i(43476),t=e.i(22016),l=e.i(71645),n=e.i(32818);async function r(e){let a=await e.text();try{return a?JSON.parse(a):{}}catch{return{erro:a||"Resposta inválida do servidor"}}}function s(e){return e.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/[^a-z0-9]+/g,"-").replace(/(^-|-$)+/g,"")}function i(){let{senhaAdmin:e,setMensagem:i,setAcaoHeader:o}=(0,n.useAdmin)(),[c,u]=(0,l.useState)([]),[d,p]=(0,l.useState)(!1),[x,m]=(0,l.useState)(""),[g,h]=(0,l.useState)(""),[b,f]=(0,l.useState)(""),[v,j]=(0,l.useState)(""),[N,y]=(0,l.useState)(""),[k,C]=(0,l.useState)(""),[S,w]=(0,l.useState)(!0),[E,T]=(0,l.useState)(!1),[P,R]=(0,l.useState)("video"),[$,O]=(0,l.useState)(""),[D,L]=(0,l.useState)(null),[M,A]=(0,l.useState)(null),U=(0,l.useRef)(null),B=(0,l.useRef)(null),[_,z]=(0,l.useState)(!1),[F,I]=(0,l.useState)(null);async function J(){if(i(null),!e)return i("Digite a senha do admin.");p(!0);let a=await fetch("/api/admin/plugins/listar",{headers:{"x-senha-admin":e},cache:"no-store"}),t=await r(a);if(p(!1),!a.ok)return i(t?.erro??"Erro ao carregar plugins.");u(t.itens??[])}async function K(){if(i(null),!e)return i("Digite a senha do admin.");let a=g.trim(),t=s(b.trim());if(!a)return i("Nome obrigatório.");if(!t)return i("Slug obrigatório.");if(!D)return i("Envie a capa.");if(!M)return i("Envie o torrent.");if("video"===P&&!k.trim())return i("Informe a URL do vídeo.");if("texto"===P&&!$.trim())return i("Informe o manual escrito.");z(!0);let l=new FormData;l.append("nome",a),l.append("slug",t),l.append("subtitulo",v.trim()),l.append("descricao",N.trim()),l.append("tipo_instalacao",P),"video"===P?l.append("conteudo_instalacao",k.trim()):l.append("conteudo_instalacao",$.trim()),l.append("ativo",String(S)),l.append("capa",D),l.append("torrent",M);let n=await fetch("/api/admin/plugins/criar",{method:"POST",headers:{"x-senha-admin":e},body:l}),o=await r(n);if(z(!1),!n.ok)return i(o?.erro??"Erro ao criar plugin.");o.plugin&&u(e=>[o.plugin,...e]),h(""),f(""),j(""),y(""),C(""),L(null),A(null),i("Plugin criado com sucesso.")}async function Y(a){if(!e||!confirm(`Excluir "${a}"?`))return;I(a);let t=await fetch("/api/admin/plugins/deletar",{method:"POST",headers:{"Content-Type":"application/json","x-senha-admin":e},body:JSON.stringify({slug:a})}),l=await r(t);if(I(null),!t.ok)return i(l?.erro??"Erro ao excluir.");u(e=>e.filter(e=>e.slug!==a)),i("Plugin excluído.")}(0,l.useEffect)(()=>(o({rotulo:"Carregar plugins",carregando:d,aoClicar:J}),()=>o(null)),[o,d,e]);let V=(0,l.useMemo)(()=>{let e=x.toLowerCase();return c.filter(a=>`${a.nome} ${a.slug}`.toLowerCase().includes(e))},[c,x]);return(0,a.jsxs)("div",{className:"flex flex-col gap-6",children:[(0,a.jsxs)("section",{className:"rounded-3xl border border-white/10 bg-white/5 p-6",children:[(0,a.jsx)("h2",{className:"text-xl font-semibold",children:"Criar plugin"}),(0,a.jsxs)("div",{className:"mt-4 grid gap-4 md:grid-cols-2",children:[(0,a.jsx)("input",{placeholder:"Nome",value:g,onChange:e=>{let a=e.target.value;h(a),E||f(s(a))},className:"rounded-2xl bg-black/30 px-4 py-3"}),(0,a.jsx)("input",{placeholder:"Slug",value:b,onChange:e=>{T(!0),f(s(e.target.value))},className:"rounded-2xl bg-black/30 px-4 py-3"}),(0,a.jsx)("textarea",{placeholder:"Subtítulo",value:v,onChange:e=>j(e.target.value),className:"md:col-span-2 rounded-2xl bg-black/30 px-4 py-3"}),(0,a.jsx)("textarea",{placeholder:"Descrição",value:N,onChange:e=>y(e.target.value),rows:4,className:"md:col-span-2 rounded-2xl bg-black/30 px-4 py-3"}),(0,a.jsxs)("div",{className:"md:col-span-2 flex gap-4",children:[(0,a.jsxs)("label",{className:"flex items-center gap-2 cursor-pointer",children:[(0,a.jsx)("input",{type:"radio",name:"tipoManual",value:"video",checked:"video"===P,onChange:()=>R("video")}),"Vídeo do YouTube"]}),(0,a.jsxs)("label",{className:"flex items-center gap-2 cursor-pointer",children:[(0,a.jsx)("input",{type:"radio",name:"tipoManual",value:"texto",checked:"texto"===P,onChange:()=>R("texto")}),"Manual escrito"]})]}),"video"===P&&(0,a.jsx)("input",{placeholder:"URL do vídeo do YouTube",value:k,onChange:e=>C(e.target.value),className:"md:col-span-2 rounded-2xl bg-black/30 px-4 py-3"}),"texto"===P&&(0,a.jsx)("textarea",{placeholder:"Manual de instalação (texto)",value:$,onChange:e=>O(e.target.value),rows:6,className:"md:col-span-2 rounded-2xl bg-black/30 px-4 py-3"}),(0,a.jsx)("button",{type:"button",onClick:()=>U.current?.click(),className:"rounded-2xl bg-black/30 px-4 py-3 text-left",children:D?`✅ ${D.name}`:"Selecionar capa"}),(0,a.jsx)("input",{ref:U,type:"file",hidden:!0,accept:"image/*",onChange:e=>L(e.target.files?.[0]??null)}),(0,a.jsx)("button",{type:"button",onClick:()=>B.current?.click(),className:"rounded-2xl bg-black/30 px-4 py-3 text-left",children:M?`✅ ${M.name}`:"Selecionar torrent"}),(0,a.jsx)("input",{ref:B,type:"file",hidden:!0,accept:".torrent",onChange:e=>A(e.target.files?.[0]??null)}),(0,a.jsxs)("div",{className:"md:col-span-2 flex justify-between items-center",children:[(0,a.jsxs)("label",{className:"flex gap-2 items-center",children:[(0,a.jsx)("input",{type:"checkbox",checked:S,onChange:e=>w(e.target.checked)}),"Ativo"]}),(0,a.jsx)("button",{onClick:K,disabled:_,className:"rounded-2xl bg-white px-6 py-3 text-black font-semibold",children:_?"Criando…":"Criar plugin"})]})]})]}),(0,a.jsxs)("section",{className:"rounded-3xl border border-white/10 bg-white/5 p-6",children:[(0,a.jsx)("h3",{className:"text-lg font-semibold mb-4",children:"Plugins cadastrados"}),(0,a.jsx)("input",{placeholder:"Buscar...",value:x,onChange:e=>m(e.target.value),className:"mb-4 w-full rounded-2xl bg-black/30 px-4 py-3"}),(0,a.jsx)("div",{className:"space-y-3",children:V.map(e=>(0,a.jsxs)("div",{className:"flex justify-between items-center rounded-2xl bg-black/20 p-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"font-semibold",children:e.nome}),(0,a.jsx)("div",{className:"text-xs text-white/60",children:e.slug})]}),(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsx)(t.default,{href:`/admin/plugins/${e.slug}`,className:"px-4 py-2 text-xs rounded-xl bg-black/30",children:"Editar"}),(0,a.jsx)("button",{onClick:()=>Y(e.slug),disabled:F===e.slug,className:"px-4 py-2 text-xs rounded-xl bg-black/30",children:F===e.slug?"Excluindo…":"Excluir"})]})]},e.id))})]})]})}e.s(["default",()=>i])}]);