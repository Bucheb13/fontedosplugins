(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,46379,e=>{"use strict";var a=e.i(43476),t=e.i(71645),l=e.i(18566),s=e.i(32818);async function r(e){let a=await e.text();try{return a?JSON.parse(a):{}}catch{return{erro:a||"Resposta inválida do servidor"}}}function i(){let{senhaAdmin:e,setMensagem:i}=(0,s.useAdmin)(),o=(0,l.useParams)().slug,[n,d]=(0,t.useState)(!1),[c,u]=(0,t.useState)(!1),[x,m]=(0,t.useState)(null),[h,p]=(0,t.useState)(!1),[b,g]=(0,t.useState)(!1),[v,f]=(0,t.useState)(!1),[w,j]=(0,t.useState)(""),[N,y]=(0,t.useState)(""),[k,S]=(0,t.useState)(!0),[T,C]=(0,t.useState)(""),[_,R]=(0,t.useState)("video"),[q,P]=(0,t.useState)(""),[A,D]=(0,t.useState)(null),[F,O]=(0,t.useState)(null),E=(0,t.useRef)(null),U=(0,t.useRef)(null),$=(0,t.useCallback)(async()=>{if(i(null),!e)return void d(!1);u(!0);try{let a=await fetch("/api/admin/validar",{headers:{"x-senha-admin":e},cache:"no-store"});if(u(!1),!a.ok){d(!1),i("Senha admin inválida.");return}d(!0)}catch{u(!1),d(!1),i("Falha ao validar a senha.")}},[e,i]),I=(0,t.useCallback)(async()=>{if(i(null),!n)return void i("Digite a senha correta do admin.");p(!0);let a=await fetch(`/api/admin/programas/obter?slug=${encodeURIComponent(o)}`,{headers:{"x-senha-admin":e},cache:"no-store"}),t=await r(a);if(p(!1),!a.ok)return void i(t?.erro??"Falha ao carregar programa.");let l=t.programa??null;m(l),l&&(j(l.nome??""),y(l.subtitulo??""),C(l.descricao??""),R(l.tipo_instalacao??"video"),P(l.conteudo_instalacao??""),S(l.ativo??!0))},[n,e,i,o]);(0,t.useEffect)(()=>{let e=setTimeout(()=>void $(),0);return()=>clearTimeout(e)},[$]),(0,t.useEffect)(()=>{if(!n)return;let e=setTimeout(()=>void I(),0);return()=>clearTimeout(e)},[n,I]);let Y=(0,t.useCallback)(async()=>{if(i(null),!n)return i("Digite a senha correta do admin.");let a=w.trim();if(!a)return i("Nome é obrigatório.");if("video"===_){let e=q.trim();if(!e)return i("Informe o link do vídeo do YouTube.");if(!function(e){try{let a=new URL(e);return a.hostname.includes("youtube.com")||a.hostname.includes("youtu.be")}catch{return!1}}(e))return i("Informe uma URL válida do YouTube.")}if("texto"===_&&!q.trim())return i("O texto de instalação é obrigatório.");g(!0);let t=await fetch("/api/admin/programas/editar",{method:"POST",headers:{"Content-Type":"application/json","x-senha-admin":e},body:JSON.stringify({slug:o,nome:a,subtitulo:N.trim()||null,descricao:T.trim()||null,tipo_instalacao:_,conteudo_instalacao:q.trim()||null,ativo:k})}).catch(()=>null);if(!t)return g(!1),i("Falha de rede ao salvar.");let l=await r(t);if(g(!1),!t.ok)return i(l?.erro??`Falha ao salvar (HTTP ${t.status}).`);let s=l.programa??null;s&&(m(s),j(s.nome??""),y(s.subtitulo??""),C(s.descricao??""),R(s.tipo_instalacao??"video"),P(s.conteudo_instalacao??"")),i("Salvo com sucesso.")},[n,e,i,o,w,N,T,_,q,k]),L=(0,t.useCallback)(async()=>{if(i(null),!n)return i("Digite a senha correta do admin.");if(!A&&!F)return i("Selecione uma capa e/ou um .torrent.");f(!0);let a=new FormData;a.append("slug",o),A&&a.append("capa",A),F&&a.append("torrent",F);let t=await fetch("/api/admin/programas/editar-arquivos",{method:"POST",headers:{"x-senha-admin":e},body:a}).catch(()=>null);if(!t)return f(!1),i("Falha de rede ao enviar arquivos.");let l=await r(t);if(f(!1),!t.ok)return i(l?.erro??`Falha ao enviar (HTTP ${t.status}).`);let s=l.programa??null;s&&(m(s),j(s.nome??""),y(s.subtitulo??"")),D(null),O(null),i("Arquivos atualizados com sucesso.")},[n,e,i,o,A,F]);return e?c?(0,a.jsx)("div",{className:"rounded-3xl border border-white/10 bg-white/5 p-6 md:p-8 text-sm text-white/70",children:"Validando senha…"}):n?h||!x?(0,a.jsx)("div",{className:"rounded-3xl border border-white/10 bg-white/5 p-6 md:p-8 text-sm text-white/70",children:h?"Carregando…":"Programa não encontrado."}):(0,a.jsxs)("div",{className:"flex flex-col gap-6",children:[(0,a.jsxs)("section",{className:"rounded-3xl border border-white/10 bg-white/5 p-6 md:p-8",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between gap-3",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h2",{className:"text-xl font-semibold",children:"Editar programa"}),(0,a.jsxs)("p",{className:"mt-1 text-sm text-white/70",children:["slug: ",(0,a.jsx)("span",{className:"text-white/80",children:x.slug})]})]}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("button",{type:"button",onClick:()=>void I(),disabled:b||h||v,className:"rounded-xl border border-white/10 bg-black/30 px-4 py-2 text-xs hover:bg-black/40 disabled:opacity-60",children:"Recarregar"}),(0,a.jsx)("button",{type:"button",onClick:()=>void Y(),disabled:b||v,className:"rounded-xl bg-white px-4 py-2 text-xs font-semibold text-black disabled:opacity-60",children:b?"Salvando…":"Salvar"})]})]}),(0,a.jsxs)("div",{className:"mt-6 grid gap-4 md:grid-cols-2",children:[(0,a.jsxs)("div",{className:"flex flex-col gap-2 md:col-span-2",children:[(0,a.jsx)("label",{className:"text-xs text-white/60",children:"Nome"}),(0,a.jsx)("input",{value:w,onChange:e=>j(e.target.value),className:"rounded-2xl border border-white/10 bg-black/30 px-4 py-3 text-sm outline-none"})]}),(0,a.jsxs)("div",{className:"flex flex-col gap-2 md:col-span-2",children:[(0,a.jsx)("label",{className:"text-xs text-white/60",children:"Subtitulo"}),(0,a.jsx)("textarea",{value:N,onChange:e=>y(e.target.value),rows:5,className:"rounded-2xl border border-white/10 bg-black/30 px-4 py-3 text-sm outline-none"})]}),(0,a.jsxs)("div",{className:"flex flex-col gap-2 md:col-span-2",children:[(0,a.jsx)("label",{className:"text-xs text-white/60",children:"Descrição completa"}),(0,a.jsx)("textarea",{value:T,onChange:e=>C(e.target.value),rows:6,className:"rounded-2xl border border-white/10 bg-black/30 px-4 py-3 text-sm outline-none",placeholder:"Descrição detalhada do programa…"})]}),(0,a.jsxs)("div",{className:"flex flex-col gap-2 md:col-span-2",children:[(0,a.jsx)("label",{className:"text-xs text-white/60",children:"Tipo de conteúdo de instalação"}),(0,a.jsxs)("select",{value:_,onChange:e=>{R(e.target.value),P("")},className:"rounded-2xl border border-white/10 bg-black/30 px-4 py-3 text-sm outline-none",children:[(0,a.jsx)("option",{value:"video",children:"Vídeo (YouTube)"}),(0,a.jsx)("option",{value:"texto",children:"Texto / Instruções"})]})]}),"video"===_&&(0,a.jsxs)("div",{className:"flex flex-col gap-2 md:col-span-2",children:[(0,a.jsx)("label",{className:"text-xs text-white/60",children:"Link do vídeo (YouTube)"}),(0,a.jsx)("input",{value:q,onChange:e=>P(e.target.value),placeholder:"https://www.youtube.com/watch?v=...",className:"rounded-2xl border border-white/10 bg-black/30 px-4 py-3 text-sm outline-none"})]}),"texto"===_&&(0,a.jsxs)("div",{className:"flex flex-col gap-2 md:col-span-2",children:[(0,a.jsx)("label",{className:"text-xs text-white/60",children:"Texto de instalação"}),(0,a.jsx)("textarea",{value:q,onChange:e=>P(e.target.value),rows:6,placeholder:"Explique como instalar o programa...",className:"rounded-2xl border border-white/10 bg-black/30 px-4 py-3 text-sm outline-none"})]}),(0,a.jsxs)("label",{className:"flex items-center gap-2 rounded-2xl border border-white/10 bg-black/30 px-4 py-3 text-sm md:col-span-2",children:[(0,a.jsx)("input",{type:"checkbox",checked:k,onChange:e=>S(e.target.checked)}),(0,a.jsx)("span",{className:"text-white/80",children:"Ativo"})]})]})]}),(0,a.jsxs)("section",{className:"rounded-3xl border border-white/10 bg-white/5 p-6 md:p-8",children:[(0,a.jsx)("h3",{className:"text-lg font-semibold",children:"Arquivos (R2)"}),(0,a.jsx)("p",{className:"mt-1 text-sm text-white/60",children:"Atualize a capa e/ou o .torrent deste programa."}),(0,a.jsxs)("div",{className:"mt-4 grid gap-3",children:[(0,a.jsxs)("div",{className:"rounded-2xl border border-white/10 bg-black/20 p-4",children:[(0,a.jsx)("div",{className:"text-white/70 text-xs",children:"Capa atual"}),x.imagem_capa_url?(0,a.jsxs)("div",{className:"mt-3 flex items-center gap-4",children:[(0,a.jsx)("img",{src:x.imagem_capa_url,alt:x.nome,className:"h-20 w-20 rounded-xl object-cover border border-white/10"}),(0,a.jsx)("div",{className:"text-xs text-white/60 break-all",children:x.imagem_capa_url})]}):(0,a.jsx)("div",{className:"mt-2 text-white/70",children:"Sem capa"})]}),(0,a.jsxs)("div",{className:"rounded-2xl border border-white/10 bg-black/20 p-4",children:[(0,a.jsx)("div",{className:"text-white/70 text-xs",children:"Torrent atual"}),(0,a.jsx)("div",{className:"mt-2 text-white/70",children:x.r2_chave_arquivo?x.r2_chave_arquivo:"Sem torrent"})]})]}),(0,a.jsxs)("div",{className:"mt-4 grid gap-4 md:grid-cols-2",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"text-xs text-white/60 mb-2",children:"Nova capa"}),(0,a.jsx)("input",{ref:E,type:"file",accept:"image/png,image/jpeg,image/webp,image/gif",className:"hidden",onChange:e=>{D(e.target.files?.[0]??null),e.currentTarget.value=""}}),(0,a.jsx)("button",{type:"button",onClick:()=>E.current?.click(),disabled:v,className:"w-full rounded-2xl border border-white/10 bg-black/30 px-4 py-3 text-sm text-left disabled:opacity-60",children:A?`✅ ${A.name}`:"Selecionar imagem…"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"text-xs text-white/60 mb-2",children:"Novo .torrent"}),(0,a.jsx)("input",{ref:U,type:"file",accept:".torrent,application/x-bittorrent",className:"hidden",onChange:e=>{O(e.target.files?.[0]??null),e.currentTarget.value=""}}),(0,a.jsx)("button",{type:"button",onClick:()=>U.current?.click(),disabled:v,className:"w-full rounded-2xl border border-white/10 bg-black/30 px-4 py-3 text-sm text-left disabled:opacity-60",children:F?`✅ ${F.name}`:"Selecionar .torrent…"})]})]}),(0,a.jsx)("div",{className:"mt-4 flex items-center justify-end",children:(0,a.jsx)("button",{type:"button",onClick:()=>void L(),disabled:v||!A&&!F,className:"rounded-2xl bg-white px-6 py-3 text-sm font-semibold text-black disabled:opacity-60",children:v?"Enviando…":"Enviar arquivos"})})]})]}):(0,a.jsx)("div",{className:"rounded-3xl border border-white/10 bg-white/5 p-6 md:p-8 text-sm text-white/70",children:"Senha admin inválida."}):(0,a.jsx)("div",{className:"rounded-3xl border border-white/10 bg-white/5 p-6 md:p-8 text-sm text-white/70",children:"Digite a senha do admin no header para editar este programa."})}e.s(["default",()=>i])}]);