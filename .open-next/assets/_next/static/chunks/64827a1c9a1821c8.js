(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,25967,e=>{"use strict";var a=e.i(43476),i=e.i(71645),t=e.i(32818);function s(e){return new Date(e).toLocaleString("pt-BR",{dateStyle:"short",timeStyle:"short"})}async function n(e){let a=await e.text();try{return a?JSON.parse(a):{}}catch{return{erro:a||"Resposta inválida do servidor"}}}function r(){let{senhaAdmin:e,setMensagem:r,setAcaoHeader:l}=(0,t.useAdmin)(),[o,d]=(0,i.useState)([]),[u,c]=(0,i.useState)(!1),[h,m]=(0,i.useState)(null),[x,p]=(0,i.useState)(null),[b,v]=(0,i.useState)(""),[f,g]=(0,i.useState)("mensal"),[j,w]=(0,i.useState)("ativa"),[y,S]=(0,i.useState)(!1),[N,C]=(0,i.useState)([]),_=(0,i.useCallback)(async()=>{if(r(null),!e)return void r("Digite a senha do admin.");c(!0);let a=await fetch("/api/admin/assinaturas/listar",{headers:{"x-senha-admin":e},cache:"no-store"}),i=await n(a);(c(!1),a.ok)?d(i.itens??[]):r(i?.erro??"Falha ao carregar assinaturas.")},[e,r]);(0,i.useEffect)(()=>(l({rotulo:"Carregar lista",carregando:u,aoClicar:_}),()=>l(null)),[l,u,_]),(0,i.useEffect)(()=>{e?(async()=>{try{let a=await fetch("/api/admin/assinaturas/listar?todosUsuarios=true",{headers:{"x-senha-admin":e},cache:"no-store"}),i=await n(a);if(!a.ok){r(i?.erro??"Falha ao carregar usuários."),C([]);return}let t=i.usuariosDisponiveis??[],s=new Set(o.map(e=>e.usuario_id)),l=t.filter(e=>!s.has(e.id));C(l)}catch(e){console.error(e),C([])}})():Promise.resolve().then(()=>C([]))},[e,o,r]);let k=(0,i.useCallback)(async()=>{if(!e)return r("Digite a senha do admin.");if(!b)return r("Selecione um usuário.");if(o.find(e=>e.usuario_id===b))return r("Usuário já possui assinatura.");S(!0);let a=null;if("ativa"===j){let e=new Date;e.setDate(e.getDate()+("mensal"===f?31:365)),a=e.toISOString()}let i=await fetch("/api/admin/assinaturas/atualizar",{method:"POST",headers:{"Content-Type":"application/json","x-senha-admin":e},body:JSON.stringify({usuarioId:b,status:j,tipo:"ativa"===j?f:null,periodo_fim:a})}),t=await n(i);if(S(!1),!i.ok)return r(t?.erro??"Falha ao criar assinatura.");let s=N.find(e=>e.id===b);d(e=>[...e,{id:Date.now().toString(),usuario_id:b,display_name:s?.display_name??null,status:j,tipo:"ativa"===j?f:null,periodo_fim:a,criado_em:new Date().toISOString()}]),r("Assinatura criada com sucesso."),v(""),g("mensal"),w("ativa"),C(e=>e.filter(e=>e.id!==b))},[e,b,f,j,o,r,N]),D=(0,i.useCallback)(async(a,i)=>{if(r(null),!e)return r("Digite a senha do admin.");m(a);let t=o.find(e=>e.usuario_id===a);if(!t)return;let s=i.status??t.status,l=i.tipo??t.tipo,u=t.periodo_fim;if("inativa"===s)l=null,u=null;else if("ativa"===s){let e=new Date;e.setDate(e.getDate()+("mensal"===l?31:365)),u=e.toISOString()}let c=await fetch("/api/admin/assinaturas/atualizar",{method:"POST",headers:{"Content-Type":"application/json","x-senha-admin":e},body:JSON.stringify({usuarioId:a,status:s,tipo:l,periodo_fim:u})}),h=await n(c);(m(null),c.ok)?(d(e=>e.map(e=>e.usuario_id===a?{...e,status:s,tipo:l,periodo_fim:u}:e)),r("Assinatura atualizada.")):r(h?.erro??"Falha ao atualizar assinatura.")},[e,r,o]),O=(0,i.useCallback)(async a=>{if(r(null),!e)return r("Digite a senha do admin.");p(a);let i=await fetch("/api/admin/assinaturas/redefinir-senha",{method:"POST",headers:{"Content-Type":"application/json","x-senha-admin":e},body:JSON.stringify({usuarioId:a})}),t=await n(i);(p(null),i.ok)?r("Email de redefinição de senha enviado."):r(t?.erro??"Falha ao enviar redefinição de senha.")},[e,r]);return(0,a.jsx)("div",{className:"flex flex-col gap-6",children:(0,a.jsxs)("section",{className:"rounded-3xl border border-white/10 bg-white/5 p-6 md:p-8",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between gap-3",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h2",{className:"text-xl font-semibold",children:"Gerenciamento de assinaturas"}),(0,a.jsx)("p",{className:"mt-1 text-sm text-white/70",children:"Controle manual do status e tipo por usuário."})]}),(0,a.jsxs)("div",{className:"text-xs text-white/60",children:[o.length," itens"]})]}),(0,a.jsxs)("div",{className:"mt-5 rounded-2xl border border-white/10 bg-black/20 p-4 flex flex-col gap-2",children:[(0,a.jsx)("h3",{className:"font-semibold",children:"Criar nova assinatura"}),(0,a.jsxs)("select",{value:b,onChange:e=>v(e.target.value),disabled:!e||0===N.length,className:"rounded-xl border border-white/10 bg-black/30 px-3 py-2 text-xs outline-none",children:[(0,a.jsx)("option",{value:"",children:0===N.length?"Nenhum usuário disponível":"Selecione um usuário"}),N.map(e=>(0,a.jsx)("option",{value:e.id,children:e.display_name?`${e.display_name} (${e.id})`:e.id},e.id))]}),(0,a.jsxs)("div",{className:"flex gap-2 mt-2",children:[(0,a.jsxs)("select",{value:f,onChange:e=>g(e.target.value),className:"rounded-xl border border-white/10 bg-black/30 px-3 py-2 text-xs outline-none",children:[(0,a.jsx)("option",{value:"mensal",children:"mensal"}),(0,a.jsx)("option",{value:"anual",children:"anual"})]}),(0,a.jsxs)("select",{value:j,onChange:e=>w(e.target.value),className:"rounded-xl border border-white/10 bg-black/30 px-3 py-2 text-xs outline-none",children:[(0,a.jsx)("option",{value:"ativa",children:"ativa"}),(0,a.jsx)("option",{value:"inativa",children:"inativa"})]}),(0,a.jsx)("button",{disabled:y||!b,onClick:k,className:"rounded-xl border border-white/10 bg-black/30 px-3 py-2 text-xs outline-none hover:bg-black/40",children:y?"Criando…":"Criar"})]})]}),0===o.length?(0,a.jsxs)("div",{className:"mt-5 rounded-2xl border border-white/10 bg-black/20 p-6 text-sm text-white/70",children:["Nenhuma assinatura carregada ainda. Digite a senha no header e clique em"," ",(0,a.jsx)("b",{children:"Carregar lista"}),"."]}):(0,a.jsx)("div",{className:"mt-5 space-y-3",children:o.map(i=>{let t=!e||h===i.usuario_id||x===i.usuario_id;return(0,a.jsxs)("div",{className:"rounded-2xl border border-white/10 bg-black/20 p-4 flex flex-col gap-3 md:flex-row md:items-center md:justify-between",children:[(0,a.jsxs)("div",{className:"min-w-0",children:[(0,a.jsxs)("div",{className:"text-sm font-semibold truncate",children:["Usuário:"," ",(0,a.jsx)("span",{className:"text-white/90",children:i.display_name||"Sem nome"})]}),(0,a.jsxs)("div",{className:"mt-1 grid gap-1 text-xs text-white/60",children:[(0,a.jsxs)("div",{children:["ID: ",i.usuario_id]}),(0,a.jsxs)("div",{children:["Criado: ",s(i.criado_em)]}),(0,a.jsxs)("div",{children:["Período fim: ",i.periodo_fim?s(i.periodo_fim):"sem data"]}),(0,a.jsxs)("div",{children:["Tipo atual: ","ativa"===i.status?i.tipo??"não definido":"—"]})]})]}),(0,a.jsxs)("div",{className:"flex flex-wrap items-center gap-2",children:["ativa"===i.status&&(0,a.jsxs)("select",{value:i.tipo??"",disabled:t,onChange:e=>void D(i.usuario_id,{tipo:e.target.value||null}),className:"rounded-xl border border-white/10 bg-black/30 px-3 py-2 text-xs outline-none disabled:opacity-60",children:[(0,a.jsx)("option",{value:"mensal",children:"mensal"}),(0,a.jsx)("option",{value:"anual",children:"anual"})]}),(0,a.jsxs)("select",{value:i.status,disabled:t,onChange:e=>void D(i.usuario_id,{status:e.target.value}),className:"rounded-xl border border-white/10 bg-black/30 px-3 py-2 text-xs outline-none disabled:opacity-60",children:[(0,a.jsx)("option",{value:"ativa",children:"ativa"}),(0,a.jsx)("option",{value:"inativa",children:"inativa"})]}),(0,a.jsx)("button",{disabled:t,onClick:()=>void O(i.usuario_id),className:"rounded-xl border border-white/10 bg-black/30 px-3 py-2 text-xs outline-none disabled:opacity-60 hover:bg-black/40",children:x===i.usuario_id?"Enviando…":"Redefinir senha"})]})]},i.id)})})]})})}e.s(["default",()=>r])}]);