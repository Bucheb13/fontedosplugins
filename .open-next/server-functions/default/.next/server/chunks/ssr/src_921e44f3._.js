module.exports=[87335,a=>{"use strict";var b=a.i(87924),c=a.i(72131);function d(a){return Math.max(0,Math.ceil((new Date(a).getTime()-Date.now())/1e3))}function e(a){return a&&"object"==typeof a?{status:"string"==typeof a.status?a.status:void 0,liberar_em:"string"==typeof a.liberar_em?a.liberar_em:null,faltam_ms:"number"==typeof a.faltam_ms?a.faltam_ms:void 0,erro:"string"==typeof a.erro?a.erro:void 0}:{}}function f({slug:a,tipo:f,assinanteAtivo:g=!1,className:h}){let[i,j]=(0,c.useState)(!0),[k,l]=(0,c.useState)(!1),[m,n]=(0,c.useState)("nao_iniciado"),[o,p]=(0,c.useState)(null),[q,r]=(0,c.useState)(0),s=(0,c.useRef)(null);function t(){null!==s.current&&(window.clearInterval(s.current),s.current=null)}function u(a){p(a),r(d(a)),t(),s.current=window.setInterval(()=>{let b=d(a);r(b),b<=0&&(n("liberado"),t())},250)}async function v(){try{let a=await fetch("/api/assinaturas/me",{method:"GET"});if(!a.ok)return;let b=await a.json();if(!b?.assinatura)return;let{periodo_fim:c,status:d,id:e}=b.assinatura;if(!c||"ativa"!==d)return;let f=new Date;new Date(c)<f&&await fetch("/api/assinaturas/inativar",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({assinaturaId:e})})}catch{}}async function w(){j(!0);try{if(await v(),g){t(),n("nao_iniciado"),p(null),r(0);return}if(!a||"undefined"===a){n("nao_iniciado"),p(null),r(0);return}let b=await fetch(`/api/download-gratis/status?slug=${encodeURIComponent(a)}&tipo=${encodeURIComponent(f)}`,{method:"GET"}),c=await b.json().catch(()=>null),d=e(c);if(!b.ok||!d.status||"nao_iniciado"===d.status||"sem_login"===d.status){n("nao_iniciado"),p(null),r(0);return}if("contando"===d.status&&d.liberar_em){n("aguardando"),u(d.liberar_em);return}if("liberado"===d.status&&d.liberar_em){n("liberado"),p(d.liberar_em),r(0);return}n("nao_iniciado"),p(null),r(0)}finally{j(!1)}}async function x(){let b=await fetch("/api/download-gratis/iniciar",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({slug:a,tipo:f})}),c=await b.json().catch(()=>null),d=e(c);if(!b.ok)throw Error(d.erro??"Não foi possível iniciar a contagem.");let g=function(a){if(!a||"object"!=typeof a||!("timer"in a))return null;let b=a.timer;return b&&"object"==typeof b&&"string"==typeof b.liberar_em?b.liberar_em:null}(c);if(!g)throw Error("Resposta inválida do servidor (liberar_em ausente).");n("aguardando"),u(g)}async function y(){let b=await fetch("/api/download-gratis/baixar",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({slug:a,tipo:f})}),c=await b.json().catch(()=>null),g=e(c);if(401===b.status){window.location.href=`/login?retorno=${encodeURIComponent(window.location.pathname)}`;return}if(b.ok){let a=c&&"object"==typeof c?c.url:null;if("string"!=typeof a||!a)throw Error("Resposta inválida do servidor (url ausente).");window.location.href=a;return}if(g.liberar_em)return void(d(g.liberar_em)>0?(n("aguardando"),u(g.liberar_em)):(n("liberado"),p(g.liberar_em),r(0)));throw Error(g.erro??"Não foi possível baixar agora.")}async function z(){if(!k){l(!0);try{await y()}catch(b){let a=b instanceof Error?b.message:"Erro inesperado.";if(a.toLowerCase().includes("inicie a contagem"))try{await x()}catch(a){alert(a instanceof Error?a.message:"Erro inesperado.")}else alert(a)}finally{l(!1)}}}(0,c.useEffect)(()=>(w(),()=>t()),[a,f,g]);let A="Baixar";if(i)A="Carregando...";else if(g)A="Baixar agora";else if("nao_iniciado"===m)A="Baixar";else if("aguardando"===m){let a;A=`Liberando em ${a=Math.floor(q/60),`${String(a).padStart(2,"0")}:${String(q%60).padStart(2,"0")}`}`}else"liberado"===m&&(A="Baixar agora");let B=(0,c.useMemo)(()=>k||!g&&"aguardando"===m,[k,m,g]);return(0,b.jsx)("button",{type:"button",onClick:()=>void z(),disabled:B,className:h??"w-full rounded-xl bg-white/10 px-4 py-3 text-sm text-white backdrop-blur transition hover:bg-white/15 disabled:cursor-not-allowed disabled:opacity-60",children:A})}a.s(["BotaoDownloadUnico",()=>f])},81924,a=>{"use strict";var b=a.i(87924),c=a.i(72131),d=a.i(50944),e=a.i(38246),f=a.i(55679),g=a.i(87335);function h(){let a;(0,c.useMemo)(()=>(0,f.criarSupabaseNavegador)(),[]);let h=(0,d.useParams)(),i=h?.slug??"",[j,k]=(0,c.useState)(null),[l,m]=(0,c.useState)([]),[n,o]=(0,c.useState)(!0),[p,q]=(0,c.useState)(null),[r,s]=(0,c.useState)("descricao");return((0,c.useEffect)(()=>{i&&(async()=>{o(!0),q(null);let a=await fetch(`/api/daws?slug=${encodeURIComponent(i)}`,{cache:"no-store"});if(!a.ok){k(null),q("Daw não encontrado."),o(!1);return}k((await a.json()).daw),o(!1)})()},[i]),(0,c.useEffect)(()=>{j&&(async()=>{let a=await fetch(`/api/daws?limit=6&exclude=${j.slug}`,{cache:"no-store"});a.ok&&m((await a.json()).daws??[])})()},[j]),n)?(0,b.jsx)("div",{className:"text-white/70",children:"Carregando daw…"}):j?(0,b.jsxs)("div",{className:"flex flex-col gap-6",children:[(0,b.jsxs)("section",{className:"relative rounded-3xl border border-white/10 bg-white/5 overflow-hidden",children:[(0,b.jsx)("div",{className:"w-full bg-black/40",children:j.imagem_capa_url?(0,b.jsx)("img",{src:j.imagem_capa_url,alt:j.nome,style:{width:"100%",height:"auto",display:"block"}}):(0,b.jsx)("div",{className:"aspect-[2/1] bg-gradient-to-br from-white/10 to-black/40"})}),(0,b.jsx)("div",{className:"pointer-events-none absolute inset-0 bg-gradient-to-t from-black/80 via-black/40 to-transparent"}),(0,b.jsxs)("div",{className:"absolute bottom-0 left-0 right-0 p-6 md:p-10",children:[(0,b.jsx)("h1",{className:"text-3xl md:text-5xl font-semibold",children:j.nome}),j.subtitulo&&(0,b.jsx)("p",{className:"mt-3 max-w-3xl text-white/80",children:j.subtitulo})]})]}),(0,b.jsx)("section",{className:"rounded-3xl border border-white/10 bg-white/5 p-6 md:p-8",children:(0,b.jsxs)("div",{className:"flex flex-col gap-4 md:flex-row md:items-center md:justify-between",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("div",{className:"text-sm text-white/60",children:"Download"}),(0,b.jsx)("div",{className:"text-lg",children:"Baixe com 1 clique"}),(0,b.jsx)("div",{className:"text-sm text-white/60",children:"Assinante: imediato • Não assinante: libera em 15 min"})]}),(0,b.jsx)("div",{className:"w-full md:w-[360px]",children:(0,b.jsx)(g.BotaoDownloadUnico,{slug:j.slug,tipo:"daw"})})]})}),(0,b.jsxs)("section",{className:"rounded-3xl border border-white/10 bg-white/5 p-6 md:p-8",children:[(0,b.jsx)("div",{className:"mb-6 flex gap-2 border-b border-white/10",children:[["descricao","Descrição"],["instalacao","Instalação"],["relacionados","Você pode gostar também"]].map(([a,c])=>(0,b.jsx)("button",{onClick:()=>s(a),className:`px-4 pb-3 text-sm font-medium transition ${r===a?"border-b-2 border-white text-white":"text-white/60 hover:text-white"}`,children:c},a))}),"descricao"===r&&(0,b.jsx)("div",{className:"text-white/80 whitespace-pre-line",children:j.descricao||(0,b.jsx)("p",{className:"text-white/50",children:"Este daw ainda não possui descrição."})}),"instalacao"===r&&(0,b.jsx)("div",{children:"video"===j.tipo_instalacao?j.conteudo_instalacao?(0,b.jsx)("div",{className:"relative aspect-video overflow-hidden rounded-2xl border border-white/10",children:(a=function(a){try{let b=new URL(a);if(b.hostname.includes("youtu.be"))return`https://www.youtube.com/embed/${b.pathname.slice(1)}`;if(b.hostname.includes("youtube.com")){let a=b.searchParams.get("v");if(a)return`https://www.youtube.com/embed/${a}`}return null}catch{return null}}(j.conteudo_instalacao))?(0,b.jsx)("iframe",{src:a,title:`Instala\xe7\xe3o - ${j.nome}`,className:"absolute inset-0 h-full w-full",allowFullScreen:!0}):(0,b.jsx)("p",{className:"text-white/50",children:"Vídeo de instalação inválido."})}):(0,b.jsx)("p",{className:"text-white/50",children:"Este daw ainda não possui vídeo de instalação."}):j.conteudo_instalacao?(0,b.jsx)("div",{className:"whitespace-pre-line text-white/80",children:j.conteudo_instalacao}):(0,b.jsx)("p",{className:"text-white/50",children:"Nenhuma instrução de instalação disponível."})}),"relacionados"===r&&(0,b.jsx)("div",{children:0===l.length?(0,b.jsx)("p",{className:"text-white/50",children:"Nenhuma sugestão disponível no momento."}):(0,b.jsx)("div",{className:"grid gap-4 sm:grid-cols-2 lg:grid-cols-3",children:l.map(a=>(0,b.jsxs)(e.default,{href:`/daws/${a.slug}`,className:"group overflow-hidden rounded-2xl border border-white/10 bg-white/5 transition hover:bg-white/10",children:[(0,b.jsx)("div",{className:"aspect-[16/9] w-full overflow-hidden",children:a.imagem_capa_url?(0,b.jsx)("img",{src:a.imagem_capa_url,alt:a.nome,className:"h-full w-full object-cover transition group-hover:scale-105"}):(0,b.jsx)("div",{className:"h-full w-full bg-white/10"})}),(0,b.jsxs)("div",{className:"p-4",children:[(0,b.jsx)("div",{className:"font-medium",children:a.nome}),a.subtitulo&&(0,b.jsx)("div",{className:"mt-1 text-sm text-white/60 line-clamp-2",children:a.subtitulo})]})]},a.id))})})]})]}):(0,b.jsx)("div",{className:"text-white/70",children:p??"Daw não encontrado."})}a.s(["default",()=>h])}];

//# sourceMappingURL=src_921e44f3._.js.map