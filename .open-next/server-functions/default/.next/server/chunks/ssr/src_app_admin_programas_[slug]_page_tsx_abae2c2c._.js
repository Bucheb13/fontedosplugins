module.exports=[84935,a=>{"use strict";var b=a.i(87924),c=a.i(72131),d=a.i(50944),e=a.i(49789);async function f(a){let b=await a.text();try{return b?JSON.parse(b):{}}catch{return{erro:b||"Resposta inválida do servidor"}}}function g(){let{senhaAdmin:a,setMensagem:g}=(0,e.useAdmin)(),h=(0,d.useParams)().slug,[i,j]=(0,c.useState)(!1),[k,l]=(0,c.useState)(!1),[m,n]=(0,c.useState)(null),[o,p]=(0,c.useState)(!1),[q,r]=(0,c.useState)(!1),[s,t]=(0,c.useState)(!1),[u,v]=(0,c.useState)(""),[w,x]=(0,c.useState)(""),[y,z]=(0,c.useState)(!0),[A,B]=(0,c.useState)(""),[C,D]=(0,c.useState)("video"),[E,F]=(0,c.useState)(""),[G,H]=(0,c.useState)(null),[I,J]=(0,c.useState)(null),K=(0,c.useRef)(null),L=(0,c.useRef)(null),M=(0,c.useCallback)(async()=>{if(g(null),!a)return void j(!1);l(!0);try{let b=await fetch("/api/admin/validar",{headers:{"x-senha-admin":a},cache:"no-store"});if(l(!1),!b.ok){j(!1),g("Senha admin inválida.");return}j(!0)}catch{l(!1),j(!1),g("Falha ao validar a senha.")}},[a,g]),N=(0,c.useCallback)(async()=>{if(g(null),!i)return void g("Digite a senha correta do admin.");p(!0);let b=await fetch(`/api/admin/programas/obter?slug=${encodeURIComponent(h)}`,{headers:{"x-senha-admin":a},cache:"no-store"}),c=await f(b);if(p(!1),!b.ok)return void g(c?.erro??"Falha ao carregar programa.");let d=c.programa??null;n(d),d&&(v(d.nome??""),x(d.subtitulo??""),B(d.descricao??""),D(d.tipo_instalacao??"video"),F(d.conteudo_instalacao??""),z(d.ativo??!0))},[i,a,g,h]);(0,c.useEffect)(()=>{let a=setTimeout(()=>void M(),0);return()=>clearTimeout(a)},[M]),(0,c.useEffect)(()=>{if(!i)return;let a=setTimeout(()=>void N(),0);return()=>clearTimeout(a)},[i,N]);let O=(0,c.useCallback)(async()=>{if(g(null),!i)return g("Digite a senha correta do admin.");let b=u.trim();if(!b)return g("Nome é obrigatório.");if("video"===C){let a=E.trim();if(!a)return g("Informe o link do vídeo do YouTube.");if(!function(a){try{let b=new URL(a);return b.hostname.includes("youtube.com")||b.hostname.includes("youtu.be")}catch{return!1}}(a))return g("Informe uma URL válida do YouTube.")}if("texto"===C&&!E.trim())return g("O texto de instalação é obrigatório.");r(!0);let c=await fetch("/api/admin/programas/editar",{method:"POST",headers:{"Content-Type":"application/json","x-senha-admin":a},body:JSON.stringify({slug:h,nome:b,subtitulo:w.trim()||null,descricao:A.trim()||null,tipo_instalacao:C,conteudo_instalacao:E.trim()||null,ativo:y})}).catch(()=>null);if(!c)return r(!1),g("Falha de rede ao salvar.");let d=await f(c);if(r(!1),!c.ok)return g(d?.erro??`Falha ao salvar (HTTP ${c.status}).`);let e=d.programa??null;e&&(n(e),v(e.nome??""),x(e.subtitulo??""),B(e.descricao??""),D(e.tipo_instalacao??"video"),F(e.conteudo_instalacao??"")),g("Salvo com sucesso.")},[i,a,g,h,u,w,A,C,E,y]),P=(0,c.useCallback)(async()=>{if(g(null),!i)return g("Digite a senha correta do admin.");if(!G&&!I)return g("Selecione uma capa e/ou um .torrent.");t(!0);let b=new FormData;b.append("slug",h),G&&b.append("capa",G),I&&b.append("torrent",I);let c=await fetch("/api/admin/programas/editar-arquivos",{method:"POST",headers:{"x-senha-admin":a},body:b}).catch(()=>null);if(!c)return t(!1),g("Falha de rede ao enviar arquivos.");let d=await f(c);if(t(!1),!c.ok)return g(d?.erro??`Falha ao enviar (HTTP ${c.status}).`);let e=d.programa??null;e&&(n(e),v(e.nome??""),x(e.subtitulo??"")),H(null),J(null),g("Arquivos atualizados com sucesso.")},[i,a,g,h,G,I]);return a?k?(0,b.jsx)("div",{className:"rounded-3xl border border-white/10 bg-white/5 p-6 md:p-8 text-sm text-white/70",children:"Validando senha…"}):i?o||!m?(0,b.jsx)("div",{className:"rounded-3xl border border-white/10 bg-white/5 p-6 md:p-8 text-sm text-white/70",children:o?"Carregando…":"Programa não encontrado."}):(0,b.jsxs)("div",{className:"flex flex-col gap-6",children:[(0,b.jsxs)("section",{className:"rounded-3xl border border-white/10 bg-white/5 p-6 md:p-8",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between gap-3",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("h2",{className:"text-xl font-semibold",children:"Editar programa"}),(0,b.jsxs)("p",{className:"mt-1 text-sm text-white/70",children:["slug: ",(0,b.jsx)("span",{className:"text-white/80",children:m.slug})]})]}),(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)("button",{type:"button",onClick:()=>void N(),disabled:q||o||s,className:"rounded-xl border border-white/10 bg-black/30 px-4 py-2 text-xs hover:bg-black/40 disabled:opacity-60",children:"Recarregar"}),(0,b.jsx)("button",{type:"button",onClick:()=>void O(),disabled:q||s,className:"rounded-xl bg-white px-4 py-2 text-xs font-semibold text-black disabled:opacity-60",children:q?"Salvando…":"Salvar"})]})]}),(0,b.jsxs)("div",{className:"mt-6 grid gap-4 md:grid-cols-2",children:[(0,b.jsxs)("div",{className:"flex flex-col gap-2 md:col-span-2",children:[(0,b.jsx)("label",{className:"text-xs text-white/60",children:"Nome"}),(0,b.jsx)("input",{value:u,onChange:a=>v(a.target.value),className:"rounded-2xl border border-white/10 bg-black/30 px-4 py-3 text-sm outline-none"})]}),(0,b.jsxs)("div",{className:"flex flex-col gap-2 md:col-span-2",children:[(0,b.jsx)("label",{className:"text-xs text-white/60",children:"Subtitulo"}),(0,b.jsx)("textarea",{value:w,onChange:a=>x(a.target.value),rows:5,className:"rounded-2xl border border-white/10 bg-black/30 px-4 py-3 text-sm outline-none"})]}),(0,b.jsxs)("div",{className:"flex flex-col gap-2 md:col-span-2",children:[(0,b.jsx)("label",{className:"text-xs text-white/60",children:"Descrição completa"}),(0,b.jsx)("textarea",{value:A,onChange:a=>B(a.target.value),rows:6,className:"rounded-2xl border border-white/10 bg-black/30 px-4 py-3 text-sm outline-none",placeholder:"Descrição detalhada do programa…"})]}),(0,b.jsxs)("div",{className:"flex flex-col gap-2 md:col-span-2",children:[(0,b.jsx)("label",{className:"text-xs text-white/60",children:"Tipo de conteúdo de instalação"}),(0,b.jsxs)("select",{value:C,onChange:a=>{D(a.target.value),F("")},className:"rounded-2xl border border-white/10 bg-black/30 px-4 py-3 text-sm outline-none",children:[(0,b.jsx)("option",{value:"video",children:"Vídeo (YouTube)"}),(0,b.jsx)("option",{value:"texto",children:"Texto / Instruções"})]})]}),"video"===C&&(0,b.jsxs)("div",{className:"flex flex-col gap-2 md:col-span-2",children:[(0,b.jsx)("label",{className:"text-xs text-white/60",children:"Link do vídeo (YouTube)"}),(0,b.jsx)("input",{value:E,onChange:a=>F(a.target.value),placeholder:"https://www.youtube.com/watch?v=...",className:"rounded-2xl border border-white/10 bg-black/30 px-4 py-3 text-sm outline-none"})]}),"texto"===C&&(0,b.jsxs)("div",{className:"flex flex-col gap-2 md:col-span-2",children:[(0,b.jsx)("label",{className:"text-xs text-white/60",children:"Texto de instalação"}),(0,b.jsx)("textarea",{value:E,onChange:a=>F(a.target.value),rows:6,placeholder:"Explique como instalar o programa...",className:"rounded-2xl border border-white/10 bg-black/30 px-4 py-3 text-sm outline-none"})]}),(0,b.jsxs)("label",{className:"flex items-center gap-2 rounded-2xl border border-white/10 bg-black/30 px-4 py-3 text-sm md:col-span-2",children:[(0,b.jsx)("input",{type:"checkbox",checked:y,onChange:a=>z(a.target.checked)}),(0,b.jsx)("span",{className:"text-white/80",children:"Ativo"})]})]})]}),(0,b.jsxs)("section",{className:"rounded-3xl border border-white/10 bg-white/5 p-6 md:p-8",children:[(0,b.jsx)("h3",{className:"text-lg font-semibold",children:"Arquivos (R2)"}),(0,b.jsx)("p",{className:"mt-1 text-sm text-white/60",children:"Atualize a capa e/ou o .torrent deste programa."}),(0,b.jsxs)("div",{className:"mt-4 grid gap-3",children:[(0,b.jsxs)("div",{className:"rounded-2xl border border-white/10 bg-black/20 p-4",children:[(0,b.jsx)("div",{className:"text-white/70 text-xs",children:"Capa atual"}),m.imagem_capa_url?(0,b.jsxs)("div",{className:"mt-3 flex items-center gap-4",children:[(0,b.jsx)("img",{src:m.imagem_capa_url,alt:m.nome,className:"h-20 w-20 rounded-xl object-cover border border-white/10"}),(0,b.jsx)("div",{className:"text-xs text-white/60 break-all",children:m.imagem_capa_url})]}):(0,b.jsx)("div",{className:"mt-2 text-white/70",children:"Sem capa"})]}),(0,b.jsxs)("div",{className:"rounded-2xl border border-white/10 bg-black/20 p-4",children:[(0,b.jsx)("div",{className:"text-white/70 text-xs",children:"Torrent atual"}),(0,b.jsx)("div",{className:"mt-2 text-white/70",children:m.r2_chave_arquivo?m.r2_chave_arquivo:"Sem torrent"})]})]}),(0,b.jsxs)("div",{className:"mt-4 grid gap-4 md:grid-cols-2",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("div",{className:"text-xs text-white/60 mb-2",children:"Nova capa"}),(0,b.jsx)("input",{ref:K,type:"file",accept:"image/png,image/jpeg,image/webp,image/gif",className:"hidden",onChange:a=>{H(a.target.files?.[0]??null),a.currentTarget.value=""}}),(0,b.jsx)("button",{type:"button",onClick:()=>K.current?.click(),disabled:s,className:"w-full rounded-2xl border border-white/10 bg-black/30 px-4 py-3 text-sm text-left disabled:opacity-60",children:G?`✅ ${G.name}`:"Selecionar imagem…"})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("div",{className:"text-xs text-white/60 mb-2",children:"Novo .torrent"}),(0,b.jsx)("input",{ref:L,type:"file",accept:".torrent,application/x-bittorrent",className:"hidden",onChange:a=>{J(a.target.files?.[0]??null),a.currentTarget.value=""}}),(0,b.jsx)("button",{type:"button",onClick:()=>L.current?.click(),disabled:s,className:"w-full rounded-2xl border border-white/10 bg-black/30 px-4 py-3 text-sm text-left disabled:opacity-60",children:I?`✅ ${I.name}`:"Selecionar .torrent…"})]})]}),(0,b.jsx)("div",{className:"mt-4 flex items-center justify-end",children:(0,b.jsx)("button",{type:"button",onClick:()=>void P(),disabled:s||!G&&!I,className:"rounded-2xl bg-white px-6 py-3 text-sm font-semibold text-black disabled:opacity-60",children:s?"Enviando…":"Enviar arquivos"})})]})]}):(0,b.jsx)("div",{className:"rounded-3xl border border-white/10 bg-white/5 p-6 md:p-8 text-sm text-white/70",children:"Senha admin inválida."}):(0,b.jsx)("div",{className:"rounded-3xl border border-white/10 bg-white/5 p-6 md:p-8 text-sm text-white/70",children:"Digite a senha do admin no header para editar este programa."})}a.s(["default",()=>g])}];

//# sourceMappingURL=src_app_admin_programas_%5Bslug%5D_page_tsx_abae2c2c._.js.map